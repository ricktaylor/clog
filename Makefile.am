ACLOCAL_AMFLAGS = -I m4

.ragel.c:
	$(AM_V_at)$(MKDIR_P) $(@D)
	$(AM_V_GEN)$(RAGEL) -V -M dump -p -o $@.dot $<
	$(AM_V_GEN)dot -Tsvg -O $@.dot
	$(AM_V_GEN)$(RAGEL) -C -G2 -o $@ $<
	
.lemon.c:
	$(AM_V_GEN)$(LEMON) -q $<
	
@srcdir@/lib/parser.h: @srcdir@/lib/parser.c
	
BUILT_SOURCES = \
	@srcdir@/lib/parser.h \
	@srcdir@/lib/parser.c
	
CLEANFILES = \
	$(BUILT_SOURCES) \
	lib/tokenizer.c
		
bin_PROGRAMS = clog

clog_SOURCES = \
	lib/parser.lemon \
	lib/tokenizer.ragel \
	lib/tokens.c \
	bin/clog.c

####################################
# Some helper targets

reallyclean: maintainer-clean
	rm -f @srcdir@/Makefile.in
	rm -f @srcdir@/aclocal.m4
	rm -f @srcdir@/configure
	rm -f @srcdir@/autoheader_dummy.h.in
	rm -f @srcdir@/autoheader_dummy.h.in~
	rm -f @srcdir@/data/Makefile.in
	rm -f @srcdir@/include/Makefile.in
	rm -f @srcdir@/m4/argz.m4
	rm -f @srcdir@/src/Makefile.in
	
####################################
# Hook to make the ChangeLog
dist-hook:
	@if test -d "$(top_srcdir)/.git"; \
	then \
		echo Creating ChangeLog && \
		( cd "$(top_srcdir)" && \
		  echo '# Generated by Makefile. Do not edit.'; echo; \
		  build-aux/missing --run git log --shortstat ) > ChangeLog.tmp \
		&& mv -f ChangeLog.tmp $(top_distdir)/ChangeLog \
		|| ( rm -f ChangeLog.tmp ; \
		     echo Failed to generate ChangeLog >&2 ); \
	else \
		echo A git clone is required to generate a ChangeLog >&2; \
	fi
